# ProGearSDK Tools

This directory contains Python tools for building NeoGeo ROMs.

## Main Tools

### progear_assets.py

The primary asset pipeline tool. Processes `assets.yaml` to generate:
- **C-ROM** (sprite graphics in NeoGeo tile format)
- **V-ROM** (ADPCM audio samples)
- **C header** with asset definitions for the SDK

```bash
# Usage
python3 tools/progear_assets.py assets.yaml -o build/

# Or via Makefile
make
```

See the [assets.yaml format](#assetsyaml-format) section below.

### genfont.py

Generates S-ROM (fix layer) font data from ASCII art definitions embedded in the script. The font covers printable ASCII characters (0x20-0x7F).

The SDK includes a pre-built `sfix.bin` generated by this tool.

```bash
# Regenerate the SDK font (usually not needed)
python3 tools/genfont.py > sdk/rom/sfix.bin
```

## Internal/Debug Tools

These tools are used for development and testing:

| Tool | Purpose |
|------|---------|
| `generate_sfix.py` | Alternative S-ROM generator using bitmap font data |
| `gen_solid_tile.py` | Creates solid color test tiles for C-ROM debugging |
| `gen_test_sprite.py` | Creates test sprite sheets for pipeline testing |

## assets.yaml Format

```yaml
# Optional: Define named palettes for sharing between assets
palettes:
  player_colors:
    source: assets/player.png    # Extract from image
  ui_colors:
    colors: [0x8000, 0xFFFF, ...] # Manual 16-color array (NeoGeo format)

# Visual assets (sprites)
visual_assets:
  # Simple static image
  - name: background
    source: assets/bg.png

  # Animated sprite
  - name: player
    source: assets/player.png
    frame_size: [32, 32]           # Width x height of each frame
    palette: player_colors         # Optional: use named palette
    animations:
      idle: { frames: [0], speed: 1, loop: true }
      walk: { frames: [0-3], speed: 4, loop: true }
      jump: { frames: [4, 5], speed: 2, loop: false }

# Sound effects (ADPCM-A: 18.5kHz mono, up to 6 simultaneous)
sound_effects:
  - name: jump
    source: assets/jump.wav
  - name: explosion
    source: assets/boom.wav

# Music tracks (ADPCM-B: variable rate, 1 channel)
music:
  - name: level1_music
    source: assets/level1.wav
    sample_rate: 22050  # Optional, default 22050
    loop: true          # Optional, default false

# Terrain (from Tiled TMX files)
tilemaps:
  - name: level1
    source: assets/level1.tmx    # Tiled TMX file
    layer: "Ground"              # Layer name in Tiled
    tileset: tiles_simple        # Visual asset for tileset graphics
    collision_layer: "Collision" # Optional: separate collision layer

# Lighting presets (pre-baked palette variants for zero-CPU transitions)
# Use for ambient effects that need smooth fades (day/night, weather)
# For quick overlays like menu dimming, use the runtime layer system instead
lighting_presets:
  night:
    brightness: 0.65             # 0.0-2.0, default 1.0
    tint: [-8, -5, 12]           # RGB shift (-31 to +31 each)
    saturation: 1.0              # 0.0-1.0, default 1.0
    fade_steps: 16               # Interpolation steps for smooth fades
```

Pre-baked presets are automatically initialized by `NGEngineInit()`.

### Terrain Workflow

1. **Create tileset**: Design 16x16 tiles in your image editor, define as a visual asset
2. **Create map in Tiled**: Import tileset, paint your level
3. **Set collision properties**: In Tiled, add Custom Properties to tiles:
   - `solid` (bool) - Blocks movement
   - `platform` (bool) - One-way platform
   - `hazard` (bool) - Damages player
   - `ladder` (bool) - Climbable
4. **Export TMX**: Save in Tiled's native format
5. **Reference in assets.yaml**: Add to `tilemaps` section
6. **Use in code**: `NGTerrainCreate(&NGTerrainAsset_level1)`

## NeoGeo ROM Formats

### C-ROM (Sprites)
- 16x16 pixel tiles, 4 bits per pixel (16 colors)
- Split into C1 (planes 0,2) and C2 (planes 1,3)
- Byte-interleaved in final ROM

### S-ROM (Fix Layer)
- 8x8 pixel tiles, 4 bits per pixel
- Column-based storage with interleaved column pairs
- Used for text and HUD elements

### V-ROM (Audio)
- ADPCM-A: 18.5kHz, 12-bit, up to 6 channels
- ADPCM-B: Variable rate (up to 55.5kHz), 16-bit, 1 channel

## Requirements

- Python 3.8+
- Pillow (`pip install pillow`)
- PyYAML (`pip install pyyaml`)
