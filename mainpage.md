# ProGearSDK {#mainpage}

A C SDK for NeoGeo homebrew development targeting the m68000 CPU.

## Architecture

ProGearSDK uses a three-layer architecture:

| Layer | Library | Description |
|-------|---------|-------------|
| **Core** | `libneogeo_core.a` | Foundation - types, fixed-point math, memory allocation |
| **HAL** | `libneogeo.a` | Hardware Abstraction Layer - direct access to NeoGeo hardware |
| **SDK** | `libprogearsdk.a` | Game Engine - high-level abstractions for game development |

Most games should use the SDK layer, which provides convenient abstractions while still allowing direct hardware access when needed.

## Quick Start

```c
#include <progearsdk.h>      // All SDK + HAL headers
#include <progear_assets.h>  // Generated by progear_assets.py

int main(void) {
    NGEngineInit();

    NGActorHandle player = NGActorCreate(&NGVisualAsset_player, 0, 0);
    NGActorAddToScene(player, FIX(160), FIX(112), 0);

    for (;;) {
        NGEngineFrameStart();

        if (NGInputHeld(NG_PLAYER_1, NG_BTN_LEFT))  NGActorMove(player, FIX(-2), 0);
        if (NGInputHeld(NG_PLAYER_1, NG_BTN_RIGHT)) NGActorMove(player, FIX(2), 0);

        NGEngineFrameEnd();
    }
}
```

## Core Modules (Foundation)

Platform-independent utilities with no hardware dependencies. Headers use the `ng_` prefix.

| Module | Description |
|--------|-------------|
| @ref ng_types.h | Base types (`u8`, `u16`, `u32`, `s8`, `s16`, `s32`, `fixed`) |
| @ref ng_math.h | Fixed-point math, trigonometry, vectors |
| @ref ng_arena.h | Bump-pointer arena memory allocator |

Include `<neogeo_core.h>` for all Core modules.

## HAL Modules (Hardware Abstraction Layer)

Low-level access to NeoGeo hardware. Headers use the `ng_` prefix.

| Module | Description |
|--------|-------------|
| @ref ng_hardware.h | Hardware registers, VRAM access, BIOS functions |
| @ref ng_color.h | 16-bit color manipulation |
| @ref ng_palette.h | Palette RAM management (256 palettes × 16 colors) |
| @ref ng_sprite.h | Sprite Control Block operations |
| @ref ng_fix.h | Fix layer (40×32 text overlay) |
| @ref ng_input.h | Controller input with edge detection |
| @ref ng_audio.h | ADPCM-A sound effects and ADPCM-B music |

Include `<neogeo_hal.h>` for all HAL modules (includes Core automatically).

## SDK Modules (Game Engine)

High-level game development abstractions.

| Module | Description |
|--------|-------------|
| @ref engine.h | Game loop lifecycle (`NGEngineInit`, `NGEngineFrameStart`, `NGEngineFrameEnd`) |
| @ref actor.h | Game objects with position, animation, and appearance |
| @ref scene.h | World management and rendering |
| @ref camera.h | Viewport control, zoom, shake, actor tracking |
| @ref backdrop.h | Parallax scrolling background layers |
| @ref terrain.h | Tile-based levels with collision detection |
| @ref physics.h | 2D rigid body simulation |
| @ref lighting.h | Palette-based visual effects (day/night, flashes) |
| @ref ui.h | Menu system with spring animations |
| @ref visual.h | Visual asset structures |

Include `<progearsdk.h>` for all modules (includes HAL automatically).

## Core Concepts

### Scene, Actor, Camera

The SDK organizes games around three core abstractions:

- **Scene**: An infinite canvas with X (right+), Y (down+), Z (depth) coordinates
- **Actor**: Visual objects created from assets, placed in the scene
- **Camera**: A 320×224 viewport into the scene

```
┌─────────────────────────────────────────────────────────────┐
│                         SCENE                               │
│   (infinite canvas with X, Y, Z coordinates)                │
│                                                             │
│     ┌─────────────────────┐                                 │
│     │       CAMERA        │  ← Viewport (320x224)           │
│     │   ┌───┐             │                                 │
│     │   │ A │  Actor      │                                 │
│     │   └───┘             │                                 │
│     └─────────────────────┘                                 │
│               ┌───┐                                         │
│               │ A │  ← Actor outside camera (not visible)   │
│               └───┘                                         │
└─────────────────────────────────────────────────────────────┘
```

### Fixed-Point Math

The m68000 has no FPU. All positions use 16.16 fixed-point:

```c
fixed x = FIX(10);              // Integer to fixed
fixed y = FIX_FROM_FLOAT(2.5);  // Float to fixed (compile-time only)
fixed z = FIX_MUL(x, y);        // Multiplication
int i = FIX_INT(z);             // Fixed to integer
```

### Memory Allocation

Use arena allocators instead of malloc/free:

```c
// Three pre-defined arenas
ng_arena_persistent  // Lives for entire game
ng_arena_state       // Reset on scene change
ng_arena_frame       // Reset every frame

// Allocation
MyStruct *s = NG_ARENA_ALLOC(&ng_arena_state, MyStruct);
```

## Game Loop

```c
int main(void) {
    NGEngineInit();  // Initialize all subsystems

    // Create game objects...

    for (;;) {
        NGEngineFrameStart();  // VBlank, watchdog, input

        // Your game logic...

        NGEngineFrameEnd();    // Update scene, render
    }
}
```

## Asset Pipeline

Define assets in `assets.yaml`:

```yaml
visual_assets:
  - name: player
    source: assets/player.png
    frame_size: [32, 32]
    animations:
      idle: { frames: [0], speed: 1, loop: true }
      walk: { frames: [0-3], speed: 4, loop: true }

sound_effects:
  - name: jump
    source: assets/jump.wav

music:
  - name: theme
    source: assets/theme.wav
```

Run `progear_assets.py` to generate `progear_assets.h` and ROM data.

## Hardware Limits

| Resource | Limit |
|----------|-------|
| Screen | 320×224 pixels |
| Sprites | 381 total, 96 per scanline |
| Fix layer | 40×32 tiles |
| Palettes | 256 × 16 colors |
| Colors | 15-bit RGB + dark bit |

## Building

```bash
make              # Build Core + HAL + SDK + demos
make core         # Build Core only
make hal          # Build Core + HAL
make sdk          # Build Core + HAL + SDK
make docs         # Generate this documentation
```

## See Also

- [HAL README](hal/README.md) - Hardware abstraction details
- [SDK README](sdk/README.md) - Game engine details
- [NeoGeo Dev Wiki](https://wiki.neogeodev.org) - Hardware documentation
